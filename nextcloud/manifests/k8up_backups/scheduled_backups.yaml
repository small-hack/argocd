---
apiVersion: k8up.io/v1
kind: Schedule
metadata:
  name: nightly-nextcloud-b2-backup
  namespace: nextcloud
spec:
  failedJobsHistoryLimit: 10
  successfulJobsHistoryLimit: 10
  backend:
    repoPasswordSecretRef:
      name: k8up-restic-b2-repo-pw-nextcloud
      key: password
    s3:
      endpoint: s3.eu-central-003.backblazeb2.com
      bucket: vmt-ncloud
      accountIDSecretRef:
        name: k8up-b2-creds-nextcloud
        key: applicationKeyId
      accountKeySecretRef:
        name: k8up-b2-creds-nextcloud
        key: applicationKey
  # daily at 2:40 PM (Central Europe Time)
  backup:
    schedule: '40 14 * * *'
    failedJobsHistoryLimit: 10
    successfulJobsHistoryLimit: 2
    # optional... not sure which port to use here? 8443? 100100? 9090?
    promURL: http://prometheus-helm-chart-kube-prometheus.monitoring:9090/
    podSecurityContext:
      runAsUser: 0
  check:
    schedule: '50 14 * * *'
    # optional... not sure which port to use here? 8443? 100100? 9090?
    promURL: http://prometheus-helm-chart-kube-prometheus.monitoring:9090/
  prune:
    schedule: '55 14 * * *'
    retention:
      keepDaily: 7
      keepWeekly: 8
