---
apiVersion: k8up.io/v1
kind: Schedule
metadata:
  name: nightly-nextcloud-b2-backup
  namespace: nextcloud
spec:
  failedJobsHistoryLimit: 10
  successfulJobsHistoryLimit: 10
  backend:
    repoPasswordSecretRef:
      name: k8up-restic-b2-repo-pw-nextcloud
      key: password
    s3:
      endpoint: s3.eu-central-003.backblazeb2.com
      bucket: vmt-ncloud
      accountIDSecretRef:
        name: k8up-b2-creds-nextcloud
        key: applicationKeyId
      accountKeySecretRef:
        name: k8up-b2-creds-nextcloud
        key: applicationKey
  # Backup nightly at 2:10 AM (Central Europe Time)
  backup:
    schedule: '10 2 * * *'
    failedJobsHistoryLimit: 10
    successfulJobsHistoryLimit: 2
    promURL: http://prometheus-helm-chart-kube-prometheus.monitoring:9090/
    podSecurityContext:
      runAsUser: 0
  # verify the backups are ok
  check:
    schedule: '30 2 * * *'
    promURL: http://prometheus-helm-chart-kube-prometheus.monitoring:9090/
  # delete old backups
  prune:
    schedule: '35 2 * * *'
    retention:
      keepDaily: 7
      keepWeekly: 8
