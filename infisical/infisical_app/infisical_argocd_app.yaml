---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: mongodb
  namespace: argocd
spec:
  project: infisical
  source:
    repoURL: 'registry-1.docker.io'
    chart: bitnamicharts/mongodb
    targetRevision: 13.16.4
    helm:
      # Docs: https://github.com/bitnami/charts/blob/main/bitnami/mongodb/values.yaml
      values: |
        ## Infisical MongoDB custom authentication
        auth:
          ## @param mongodb.auth.enabled Enable custom authentication
          enabled: true
          ## @param mongodb.auth.usernames Custom usernames list ([special characters warning](https://www.mongodb.com/docs/manual/reference/connection-string/#standard-connection-string-format))
          usernames:
            - "infisical"
          ## Existing secret with MongoDB credentials
          # keys: mongodb-passwords, mongodb-root-password, mongodb-metrics-password, mongodb-replica-set-key
          existingSecret: "infisical-mongodb-credentials"
        ## MongoDB persistence configuration
        persistence:
          ## @param mongodb.persistence.enabled Enable database persistence
          enabled: true
          ## @param mongodb.persistence.existingClaim Existing persistent volume claim name
          existingClaim: ""
  destination:
    server: "https://kubernetes.default.svc"
    namespace: infisical
  syncPolicy:
    syncOptions:
     - ApplyOutOfSyncOnly=true
    automated:
      prune: true
      selfHeal: true
