# KubeVirt extends Kubernetes by adding additional virtualization resource types 
# (especially the VM type) through Kubernetes's Custom Resource Definitions API. 
# By using this mechanism, the Kubernetes API can be used to manage these VM resources 
# alongside all other resources Kubernetes provides.
# https://github.com/kubevirt/kubevirt
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: kubevirt-operator
  namespace: argocd
spec:
  project: kubevirt
  destination:
    namespace: kubevirt
    server: 'https://kubernetes.default.svc'
  source:
    repoURL: 'https://cloudymax.github.io/kubevirt-community-stack/'
    targetRevision: 0.1.4
    chart: kubevirt
    helm:
      values: |
        replicaCount: 1
        
        image:
          repository: quay.io/kubevirt/virt-operator
          pullPolicy: IfNotPresent
          tag: "v1.0.0"
        
        imagePullSecrets: []
        nameOverride: ""
        fullnameOverride: ""
        
        serviceAccount:
          create: true
          annotations: {}
          name: "kubevirt-operator"
        
        podAnnotations: {}
        
        podSecurityContext: {}
        
        securityContext:
          privileged: true
        
        resources: {}
        
        nodeSelector: {}
        tolerations:
          - key: CriticalAddonsOnly
            operator: Exists
        
        affinity:
          podAntiAffinity:
            preferredDuringSchedulingIgnoredDuringExecution:
              - podAffinityTerm:
                  labelSelector:
                    matchExpressions:
                      - key: kubevirt.io
                        operator: In
                        values:
                          - virt-operator
                  topologyKey: kubernetes.io/hostname
                weight: 1
        
        priorityclass:
          create: true
          value: 1000000000
          
        permittedHostDevices:
          pciHostDevices:
          - pciVendorSelector: "10DE:1EB8"
            resourceName: "nvidia.com/TU104GL_Tesla_T4"
          mediatedDevices: []
        
        mediatedDevicesTypes: []
        
        permittedHostDevices:
          pciHostDevices:
          - pciVendorSelector: "10DE:1EB8"
            resourceName: "nvidia.com/TU104GL_Tesla_T4"
        
        mediatedDevices: []
        mediatedDevicesTypes: []
        useEmulation: false
        
        featureGates:
          - ExpandDisks
          - CPUManager
          - GPU
          - HostDevices
          - VMExport
          - HotplugVolumes
          - HostDisk
          - Macvtap
          - Passt
          - HotplugNICs
          - clientPassthrough
          - Snapshot
          - CPUNodeDiscovery
  sources: []
  syncPolicy:
    automated:
      prune: false
      selfHeal: true
    syncOptions:
      - CreateNamespace=false

